\section{Entwurf}
\label{sec:TestEntwurf}

\begin{figure}[H]
\centering
\includegraphics[scale=.3]{Abbildungen/entwurf.drawio}
\caption{Skizze Entwurf}
\label{fig:pixelkreis}
\end{figure}

Mit dem Test-System soll es möglich sein Schlüsselpunkte und Deskriptoren aus Bildern zu extrahieren und Matches mit anderen Bildern zu finden. 
Zum extrahieren der Schlüsselpunkte und Deskriptoren kommen SIFT, ORB und BRISK (siehe Abschnitt \ref{sec:m-based}) zum Einsatz.
Für das finden von Matches werden der Brute-Force Matcher und der FLANN-Based Matcher (siehe Abschnitt \ref{sec:MatchingStrategien}) verwendet.

Bei dem Vergleich von Bildern soll es  die Möglichkeit geben auszuwählen, welcher feature-based Algorithmus und welcher Matcher verwendet wird. 
Dadurch können die verschiedenen Algorithmen einzeln getestet werden.
Die gefundenen Matches werden anschließend mit dem "ratio test"\ (siehe Abschnitt \ref{sec:RatioTest}) gefiltert.
Der Grenzwert für den "ratio test"\ wird dabei auf 0.8 festgelegt. 

Mithilfe der Formel zur Bestimmung der Bildähnlichkeit (siehe Abschnitt \ref{sec:Formel}) wird anhand der Matches ein Ähnlichkeits-Score für die verglichenen Bilder errechnet.
Wie hoch der Ähnlichkeits-Score sein muss, damit die verglichenen Bilder als Duplikate gelten, soll dynamisch festgelegt werden können.

Außerdem sollen Bilder wahlweise auch mit pHash-Werten (siehe Abschnitt \ref{sec:pHash}) verglichen werden. 
Damit kann man das System auch für die Evaluation der pHash-Implementation, die in der Spread Group zum Einsatz kommt, verwenden. 
Die maximale Hamming-Distanz der pHash Werte, für die zwei Bilder als Duplikate gelten, wird auf 4 festgelegt.

Die Daten der Bilder, die für die Tests verwendet werden, werden in einer Datenbank gespeichert. 
Mit dem Test-System soll es möglich sein Bilder für den Datenbanksatz und für die Suchsets der Test-Szenarien in der Datenbank zu registrieren. 
Beim registrieren eines neuen Bildes für den Datenbanksatz werden die Deskriptoren jeweils mit SIFT, ORB und BRISK, sowie der pHash Wert generiert und in der Datenbank gespeichert.
Für die Bilder in den Suchsätzen werden das Test-Szenario, sowie eine Referenz zum Originalbild aus dem Datenbanksatz, falls es sich um ein Duplikat handelt, gespeichert. 
Dadurch lässt sich beim testen feststellen, ob das Suchbild richtig klassifiziert wurde.

Des Weiteren sollen auch vordefinierte Szenarien (siehe Abschnitt \ref{sec:TestSzenarien}) implementiert werden, die automatisiert ausgeführt werden.
Beim Durchlauf eines Szenarios wird der entsprechende Suchsatz geladen. 
Jedes Bild aus dem Suchsatz wird mit jedem Bild im Datenbanksatz abgeglichen. 
Für jeden Durchlauf eines Szenarios werden die Metriken aus Abschnitt \ref{sec:TestMetriken} festgehalten. 

\section{Umsetzung}
\label{sec:TestUmsetzung}
Das Test-System wurde in Go \cite{go} mit der Version 1.21.0 umgesetzt. 
Für die Bedienung des Systems wurde ein simples Kommandozeilen Interface erstellt.
Mit dem Interface lassen sich zwei gewählte Bilder miteinander oder ein einzelnes Bild mit den Bildern aus dem Datenbankset vergleichen. 
Außerdem lassen sich über das Interface die automatisierten Test-Szenarien starten.

SIFT, ORB und BRIEF, sowie der Brute-Force und der FLANN-Based Matcher wurden über die Computer Vision Bibliothek OpenCV \cite{opencv} der Version 4.8.0 implementiert.
Da OpenCV keine Version für Go bereitstellt wird GoCV \cite{gocv} der Version 0.34.0 genutzt. GoCV bietet ein Interface für die C-Implemtierung von OpenCV, dass in Go nutzbar ist. Für das persistieren der Daten der Suchsatz-Bilder und der Datenbank-Satzbilder wurde eine MySQL-Datenbank \cite{mysql} genutzt.

Für die Einschätzung der Laufzeit wird die Zeit die ein Algorithmus braucht, um Schlüsselpunkte und Deskriptoren zu extrahieren, gestoppt. 
Außerdem wird auch die Zeit gemessen, die für das Vergleichen der Suchbild-Deskriptoren mit den Deskriptoren der Bilder aus dem Datenbanksatz nötig ist. 
Für den Vergleich werden die Deskriptoren der Datenbanksatz-Bilder in Chunks aus der Datenbank geladen. 
Um zu vermeiden das die Abfragelatenz die Laufzeitmessung beeinflusst, wird für jedes Datenbanksatz-Bild einzeln gemessen, wie lange der Vergleich dauert.

Für die Auswertung des Baseline-Algorithmus wird der pHash-calculator der Spread Group lokal laufen gelassen. 
Der pHash-calculator bietet bereits einen HTTP-Endpunkt, mit dem der pHash-Wert für einzelne Bilder errechnet werden kann.
Auch hier soll eine latenzfreie Messung der Laufzeit gewährleistet werden. 
Dazu wurde der pHash-calculator so erweitert, dass er die Zeit zum errechnen des pHash-wert selber misst und zusammen mit dem Hash über den Http-Endpunkt zurück gibt.
